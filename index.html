<!-- index.html（全文置換：大会→試合自動反映＋管理者招待即Admin化＋管理者試合一覧フィルタ） -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WANABEE</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@600;700;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand" aria-label="WANABEE">WANABEE</div>

    <div class="topbar-right">
      <span id="top-status" class="top-status"></span>
      <button id="logout-btn" class="btn ghost" style="display:none;">ログアウト</button>
    </div>
  </header>

  <section id="login-section" class="card">
    <h2 class="section-title">ログイン</h2>

    <div class="form-grid">
      <label class="field">
        <span class="label">メールアドレス</span>
        <input type="email" id="email" placeholder="メールアドレス" autocomplete="email" />
      </label>

      <label class="field">
        <span class="label">パスワード</span>
        <input type="password" id="password" placeholder="パスワード" autocomplete="current-password" />
      </label>
    </div>

    <div class="row">
      <button id="login-btn" class="btn">ログイン</button>
      <button id="signup-btn" class="btn ghost">新規登録</button>
    </div>

    <p id="login-status" class="hint"></p>
  </section>

  <!-- 管理者招待リンクから来た人向け：即Admin化 -->
  <section id="admin-enroll-section" class="card" style="display:none;">
    <h2 class="section-title">管理者登録</h2>
    <p class="hint">
      管理者招待リンクが検出されました。ログイン後に「管理者になる」を押すと管理者権限が付与されます。
    </p>
    <div class="row">
      <button id="admin-enroll-btn" class="btn">管理者になる</button>
      <button id="admin-enroll-cancel-btn" class="btn ghost">キャンセル</button>
    </div>
    <p id="admin-enroll-status" class="hint"></p>
  </section>

  <!-- UID確認（初回のみ） -->
  <section id="uid-verify-section" class="card" style="display:none;">
    <h2>UID確認</h2>
    <p class="hint">
      以下のUIDを、入力欄に正確に入力してください（大文字小文字区別）。
    </p>

    <div class="hint">UID:</div>
    <div id="uid-display" style="font-weight:800; font-size: 18px; margin: 6px 0 10px;"></div>

    <input id="uid-input" type="text" placeholder="ここにUIDを入力" style="width:100%; max-width:680px;" />

    <p id="uid-hint" class="hint" style="display:none; color:#c00; margin-top:8px;">
      表示中の文字列と一致すると認証できます
    </p>

    <div class="row" style="margin-top:10px;">
      <button id="uid-verify-btn" disabled class="btn">認証</button>
    </div>
  </section>

  <section id="rep-home-section" class="card" style="display:none;">
    <h2 class="section-title">チームメニュー</h2>
    <div class="row">
      <button id="open-player-registry-btn" class="btn">選手登録</button>
      <button id="open-matches-btn" class="btn ghost">試合一覧</button>
    </div>

    <p class="hint" style="margin-top:10px;">
      試合参加前に選手登録を行なってください。
    </p>
  </section>

  <section id="player-registry-section" class="card" style="display:none;">
    <h2 class="section-title">選手登録</h2>

    <div class="row">
      <button id="back-to-home-btn" class="btn ghost">← メニューに戻る</button>
      <button id="go-to-matches-btn" class="btn ghost">試合一覧へ</button>
    </div>

    <hr class="sep" />

    <h3 class="subhead">大会名を選択</h3>
    <p class="hint">選手を登録する大会を選んでください。</p>

    <div class="row">
      <select id="registry-tournament-select" class="select" style="min-width:260px;">
        <option value="">大会を選択</option>
      </select>
      <button id="load-registry-btn" class="btn">読み込む</button>
    </div>
    <p id="registry-context" class="hint"></p>

    <!-- ★追加：大会に含まれる試合（あなたのチーム参加分） -->
    <div id="registry-matches-box" style="display:none; margin-top:10px;">
      <div class="hint">この大会に含まれる試合（あなたのチームが参加する試合）</div>
      <div class="row">
        <select id="registry-match-select" class="select" style="min-width:260px;">
          <option value="">（確認用）試合を選択</option>
        </select>
      </div>
      <p class="hint">選手登録は、この大会に含まれる参加試合へ自動反映されます（背番号キーで上書き/追記）。</p>
    </div>

    <hr class="sep" />

    <h3 class="subhead">一括追加（背番号,名前）</h3>
    <textarea id="registry-bulk" rows="6" style="width:100%;" placeholder="例：
12,山田太郎
7,佐藤花子
"></textarea>
    <div class="row">
      <button id="registry-bulk-add-btn" class="btn">一括追加</button>
    </div>

    <hr class="sep" />
    
    <h3 class="subhead">個別追加（追加登録時）</h3>
    <div class="row">
      <input type="text" id="registry-player-number" placeholder="背番号（例：12）" />
      <input type="text" id="registry-player-name" placeholder="選手名（例：山田 太郎）" style="min-width:240px;" />
      <button id="registry-add-player-btn" class="btn">追加</button>
    </div>

    <h3 class="subhead">登録済み（編集・削除）</h3>
    <div class="row">
      <input type="text" id="registry-search" placeholder="検索（背番号/名前）" style="min-width:240px;" />
      <button id="registry-clear-search-btn" class="btn ghost">クリア</button>
    </div>

    <ul id="registry-players-list" class="list"></ul>
  </section>

  <section id="admin-section" class="card" style="display:none;">
    <h2 class="section-title">試合作成</h2>

    <div class="row">
      <button id="admin-back-to-matches-btn" class="btn ghost">← 試合一覧に戻る</button>
    </div>

    <p class="hint">
      「チーム名」「代表者メール」「大会種別（選択 or 新規作成）」を入力すると、試合が作成されます。
    </p>

    <div class="row" style="align-items:flex-end;">
      <div style="flex:1; min-width:260px;">
        <input type="text" id="team-a-name" placeholder="チーム名A（表示用）" />
        <div style="height:10px;"></div>
        <input type="email" id="team-a-email" placeholder="チームA代表者メール" />
      </div>

      <div class="vs" style="align-self:center;">vs</div>

      <div style="flex:1; min-width:260px;">
        <input type="text" id="team-b-name" placeholder="チーム名B（表示用）" />
        <div style="height:10px;"></div>
        <input type="email" id="team-b-email" placeholder="チームB代表者メール" />
      </div>
    </div>

    <div class="row" style="margin-top:10px;">
      <select id="admin-tournament-select" class="select" style="min-width:260px;">
        <option value="">大会種別（選択）</option>
      </select>

      <input type="text" id="admin-new-tournament-id" placeholder="新規作成（英数字小文字）" style="min-width:240px;" />
      <button id="create-match-btn" class="btn">作成</button>
    </div>

    <p class="hint">
      大会種別を新規作成する場合は <b>英数字小文字</b> で作成してください（例：2020tokyo）。
    </p>

    <p id="admin-info" class="hint"></p>
  </section>

  <section id="matches-section" class="card" style="display:none;">
    <h2 class="section-title">試合一覧</h2>

    <div class="row" style="margin-bottom:10px;">
      <button id="matches-back-to-home-btn" class="btn ghost">← 戻る</button>
      <button id="matches-open-create-btn" class="btn" style="display:none;">試合作成</button>
    </div>

    <!-- 管理者ブロック -->
    <div id="matches-admin-block" style="display:none;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <h3 class="subhead" style="margin:0;">全試合（管理者メニュー）</h3>

        <button id="admin-invite-btn" class="btn ghost">管理者招待用リンクを作成</button>
      </div>

      <!-- ★追加：大会フィルタ -->
      <div class="row" style="margin-top:10px; align-items:center;">
        <div class="hint" style="margin:0;">大会で絞り込み</div>
        <select id="admin-matches-tournament-filter" class="select" style="min-width:260px;">
          <option value="">すべて</option>
        </select>
      </div>

      <!-- 招待リンク表示 -->
      <div id="admin-invite-box" style="display:none; margin-top:10px;">
        <div class="hint">招待リンク（1回限り）</div>
        <div class="row">
          <input id="admin-invite-url" type="text" readonly />
          <button id="admin-invite-copy-btn" class="btn">コピー</button>
        </div>
        <p class="hint" style="margin-top:6px;">このリンクは、<b>新規登録済みユーザー</b>にのみ有効です。</p>
      </div>

      <ul id="admin-matches-list" class="list"></ul>
      <hr class="sep" />
    </div>

    <h3 class="subhead">参加可能な試合</h3>
    <ul id="matches-list" class="list"></ul>
  </section>

  <section id="team-admin-section" class="card" style="display:none;">
    <h2 class="section-title">選手管理（試合単位）</h2>

    <div class="row">
      <button id="back-to-matches-from-admin-btn" class="btn ghost">← 試合一覧に戻る</button>
      <button id="go-to-score-from-admin-btn" class="btn">試合入力に進む</button>
    </div>

    <p id="team-admin-context" class="hint"></p>

    <hr class="sep" />

    <h3 class="subhead">試合単位：選手リスト（この試合で使用）</h3>

    <h4 class="subsub">この試合：一括登録（背番号,名前）</h4>
    <textarea id="bulk-match-players" rows="6" style="width:100%;" placeholder="例：
12,山田太郎
7,佐藤花子
"></textarea>
    <div class="row">
      <button id="bulk-add-match-btn" class="btn">この試合へ一括追加</button>
    </div>

    <h4 class="subsub">この試合：個別追加</h4>
    <div class="row">
      <input type="text" id="match-player-number" placeholder="背番号（例：12）" />
      <input type="text" id="match-player-name" placeholder="名前（例：山田 太郎）" />
      <button id="add-match-player-btn" class="btn">追加</button>
    </div>

    <h4 class="subsub">この試合：登録済み（編集・削除）</h4>
    <ul id="match-players-list" class="list"></ul>
  </section>

  <section id="score-section" class="card" style="display:none;">
    <h2 class="section-title">試合入力</h2>

    <div class="row">
      <button id="back-to-matches-btn" class="btn ghost">← 試合一覧に戻る</button>
      <button id="open-team-admin-btn" class="btn ghost">選手情報を編集する</button>
    </div>

    <div class="row" style="margin-top:10px;">
      <button id="start-timer-btn" class="btn">タイマー開始</button>
      <button id="stop-timer-btn" class="btn ghost">一時停止</button>
      <button id="reset-timer-btn" class="btn ghost">リセット</button>
      <span id="timer-share-status" class="hint" style="margin-left:8px;"></span>
    </div>

    <div class="scoreboard">
      <div class="team-col left">
        <div id="team-left-name" class="team-name">—</div>
        <div id="score-left" class="team-score">0</div>
      </div>

      <div class="center-col">
        <div id="timer" class="timer">00:00</div>
      </div>

      <div class="team-col right">
        <div id="team-right-name" class="team-name">—</div>
        <div id="score-right" class="team-score">0</div>
      </div>
    </div>

    <div class="controls">
      <div class="row">
        <select id="player-select" class="select">
          <option value="">得点した選手を選択</option>
        </select>

        <select id="assist-select" class="select">
          <option value="">アシスト（任意）</option>
        </select>
      </div>

      <div class="center-actions">
        <button id="record-goal-btn" class="btn">得点</button>
        <button id="record-callahan-btn" class="btn ghost">キャラハン</button>
      </div>
      <p id="event-controls-hint" class="hint"></p>
    </div>

    <h3 class="subhead" style="margin-top:16px;">試合記録</h3>
    <div id="event-list" class="event-list"></div>
  </section>

  <script type="module" src="app.js"></script>
</body>
</html>
